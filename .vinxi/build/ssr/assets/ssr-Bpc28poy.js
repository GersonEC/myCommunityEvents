import{H3Event as H,getRequestURL as ae,getResponseHeaders as ie,getRequestWebStream as ce,getRequestHeaders as ue,getResponseStatus as de,eventHandler as J}from"h3";import{getContext as le}from"unctx";import{AsyncLocalStorage as fe}from"node:async_hooks";import{isPlainArray as pe,isPlainObject as q,defer as he,useRouter as g,pick as me,ScriptOnce as O,createControlledPromise as ye,RouterProvider as _e,createMemoryHistory as ge,defaultTransformer as m,useRouterState as w,createRootRoute as ve,Outlet as Se,ScrollRestoration as we,createFileRoute as z,lazyRouteComponent as G,encode as xe,isRedirect as M,isNotFound as $,createRouter as Re}from"@tanstack/react-router";import{jsxs as _,Fragment as y,jsx as d}from"react/jsx-runtime";import*as R from"react";import{createElement as Q}from"react";import T from"jsesc";import x from"tiny-invariant";import{Transform as Te,PassThrough as be}from"node:stream";import{isbot as N}from"isbot";import C from"react-dom/server";import{Context as X}from"@tanstack/react-cross-context";import{PrismaClient as Ee}from"@prisma/client";function Ce(e,r,t){if(!t.router.isServer)return r;t.match.extracted=t.match.extracted||[];const n=t.match.extracted;return j(r,(s,a)=>{const i=s instanceof ReadableStream?"stream":s instanceof Promise?"promise":void 0;if(i){const c={dataType:e,type:i,path:a,id:n.length,value:s,matchIndex:t.match.index};if(n.push(c),i==="stream"){const[u,l]=s.tee();return c.streamState=je({stream:l}),u}else he(s)}return s})}function He(e){const r=g(),t=r.state.matches[e.matchIndex];if(!r.isServer)return null;const n=t.extracted,[o,s]=["__beforeLoadContext","loaderData"].map(a=>n?n.reduce((i,c)=>c.dataType!==a?P(i,["temp",...c.path],void 0):i,{temp:t[a]}).temp:t[a]);if(o!==void 0||s!==void 0||n?.length){const a=`__TSR__.initMatch(${T({index:e.matchIndex,__beforeLoadContext:r.options.transformer.stringify(o),loaderData:r.options.transformer.stringify(s),extracted:n?Object.fromEntries(n.map(i=>[i.id,me(i,["type","path"])])):{}},{isScriptContext:!0,wrap:!0,json:!0})})`;return _(y,{children:[d(O,{children:a}),n?n.map(i=>i.type==="stream"?d($e,{entry:i},i.id):d(Oe,{entry:i},i.id)):null]})}return null}function j(e,r,t=[]){if(pe(e))return e.map((o,s)=>j(o,r,[...t,`${s}`]));if(q(e)){const o={};for(const s in e)o[s]=j(e[s],r,[...t,s]);return o}const n=r(e,t);return n!==e?n:e}function Oe({entry:e}){return d("div",{className:"tsr-once",children:d(R.Suspense,{fallback:null,children:d(Me,{entry:e})})})}function Me({entry:e}){const r=g();if(e.value.status==="pending")throw e.value;const t=`__TSR__.resolvePromise(${T(e,{isScriptContext:!0,wrap:!0,json:!0})})`;return r.injectScript(t),d(y,{})}function $e({entry:e}){x(e.streamState,"StreamState should be defined");const r=g();return d(V,{streamState:e.streamState,children:t=>{const n=t?`__TSR__.matches[${e.matchIndex}].extracted[${e.id}].value.controller.enqueue(new TextEncoder().encode(${T(t.toString(),{isScriptContext:!0,wrap:!0,json:!0})}))`:`__TSR__.matches[${e.matchIndex}].extracted[${e.id}].value.controller.close()`;return r.injectScript(n),d(y,{})}})}function je({stream:e}){const r={promises:[]},t=e.getReader(),n=o=>(r.promises[o]=ye(),t.read().then(({done:s,value:a})=>{if(s){r.promises[o].resolve(null),t.releaseLock();return}return r.promises[o].resolve(a),n(o+1)}));return n(0).catch(o=>{console.error("stream read error",o)}),r}function V({streamState:e,children:r,__index:t=0}){const n=e.promises[t];if(!n)return null;if(n.status==="pending")throw n;const o=n.value;return _(y,{children:[r(o),d("div",{className:"tsr-once",children:d(R.Suspense,{fallback:null,children:d(V,{streamState:e,__index:t+1,children:r})})})]})}function P(e,r,t){if(r.length===0)return t;const[n,...o]=r;return Array.isArray(e)?e.map((s,a)=>a===Number(n)?P(s,o,t):s):q(e)?{...e,[n]:P(e[n],o,t)}:e}function L(e){e.router.AfterEachMatch=He,e.router.serializer=n=>T(n,{isScriptContext:!0,wrap:!0,json:!0});const r=X.get("TanStackRouterHydrationContext",{}),t=R.useMemo(()=>{var n,o;return{router:e.router.dehydrate(),payload:(o=(n=e.router.options).dehydrate)==null?void 0:o.call(n)}},[e.router]);return d(r.Provider,{value:t,children:d(_e,{router:e.router})})}function Pe(e){let r;const t=Y(e),n={duplex:"half",method:e.method,headers:e.headers};return e.node.req.body instanceof ArrayBuffer?new Request(t,{...n,body:e.node.req.body}):new Request(t,{...n,get body(){return r||(r=Ne(e),r)}})}function Z(e){return e.web??={request:Pe(e),url:Y(e)},e.web.request}function Fe(){return A()}const K=Symbol("$HTTPEvent");function Ie(e){return typeof e=="object"&&(e instanceof H||e?.[K]instanceof H||e?.__is_event__===!0)}function b(e){return function(...r){let t=r[0];if(Ie(t))r[0]=t instanceof H||t.__is_event__?t:t[K];else{if(!globalThis.app.config.server.experimental?.asyncContext)throw new Error("AsyncLocalStorage was not enabled. Use the `server.experimental.asyncContext: true` option in your app configuration to enable it. Or, pass the instance of HTTPEvent that you have as the first argument to the function.");if(t=Fe(),!t)throw new Error("No HTTPEvent found in AsyncLocalStorage. Make sure you are using the function within the server runtime.");r.unshift(t)}return e(...r)}}const qe=b(ue),Y=b(ae),Ae=b(de),ke=b(ie),Ne=b(ce);function Le(){return le("nitro-app",{asyncContext:!!globalThis.app.config.server.experimental?.asyncContext,AsyncLocalStorage:fe})}function A(){return Le().use().event}function De(e){return e instanceof Headers?new Headers(e):Array.isArray(e)?new Headers(e):typeof e=="object"?new Headers(e):new Headers}function F(...e){return e.reduce((r,t)=>{const n=De(t);for(const[o,s]of n.entries())r.set(o,s);return r},new Headers)}function Be({createRouter:e,getRouterManifest:r}){return t=>J(async n=>{const o=Z(n),s=new URL(o.url),a=s.href.replace(s.origin,""),i=ge({initialEntries:[a]}),c=e();c.serializeLoaderData=Ce,r&&(c.manifest=r()),c.update({history:i}),await c.load();const u=We({event:n,router:c});return await t({request:o,router:c,responseHeaders:u})})}function We(e){e.event.__tsrHeadersSent=!0;let r=F(ke(e.event),{"Content-Type":"text/html; charset=UTF-8"},...e.router.state.matches.map(n=>n.headers));const{redirect:t}=e.router.state;return t&&(r=F(r,t.headers,{Location:t.href})),r}function Ue(e){const r=ee(()=>e.injectedHtml.map(t=>t()).join(""));return new Te({transform(t,n,o){r.transform(t,this.push.bind(this)).then(()=>o()).catch(s=>o(s))},flush(t){r.flush(this.push.bind(this)).then(()=>t()).catch(n=>t(n))}})}function Je(e){const r=ee(()=>e.injectedHtml.map(n=>n()).join("")),t=new TextEncoder;return new TransformStream({transform(n,o){return r.transform(n,s=>(o.enqueue(t.encode(s)),!0))},flush(n){return r.flush(o=>(n.enqueue(o),!0))}})}const ze=/(<body)/,Ge=/(<\/body>)/,Qe=/(<\/html>)/,Xe=/(<\/[a-zA-Z][\w:.-]*?>)/g,Ve=new TextDecoder;function ee(e){let r=!1,t="",n="";return{async transform(o,s){const a=t+Ve.decode(o),i=a.match(ze),c=a.match(Ge),u=a.match(Qe);try{if(i&&(r=!0),!r){s(a),t="";return}const l=e();if(c&&u&&c.index<u.index){const f=c.index+c[0].length,p=u.index+u[0].length,h=a.slice(0,f)+l+a.slice(f,p)+a.slice(p);s(h),t=""}else{let f,p=0;for(;(f=Xe.exec(a))!==null;)p=f.index+f[0].length;if(p>0){const h=a.slice(0,p)+l+n;s(h),t=a.slice(p)}else t=a,n+=l}}catch(l){throw console.error("Error transforming HTML:",l),l}},async flush(o){t&&o(t)}}}const Ze=async({request:e,router:r,responseHeaders:t})=>{if(typeof C.renderToReadableStream=="function"){const n=await C.renderToReadableStream(d(L,{router:r}),{signal:e.signal});N(e.headers.get("User-Agent"))&&await n.allReady;const s=[Je(r)].reduce((a,i)=>a.pipeThrough(i),n);return new Response(s,{status:r.state.statusCode,headers:t})}if(typeof C.renderToPipeableStream=="function"){const n=new be,o=C.renderToPipeableStream(d(L,{router:r}),{...N(e.headers.get("User-Agent"))?{onAllReady(){o.pipe(n)}}:{onShellReady(){o.pipe(n)}},onError:(i,c)=>{console.log("Error in renderToPipeableStream:",i,c)}}),a=[Ue(r)].reduce((i,c)=>i.pipe(c),n);return new Response(a,{status:r.state.statusCode,headers:t})}throw new Error("No renderToReadableStream or renderToPipeableStream found in react-dom/server. Ensure you are using a version of react-dom that supports streaming.")},Ke=()=>({routes:{__root__:{filePath:"__root.tsx",children:["/","/calendar"],preloads:["/_build/assets/client-CjWbXnil.js","/_build/assets/client-CQfkRPTm.js"]},"/":{filePath:"index.tsx"},"/calendar":{filePath:"calendar.tsx"}}});function te(e){return globalThis.MANIFEST[e]}function Ye(){const e=Ke(),r=e.routes.__root__=e.routes.__root__||{};r.assets=r.assets||[];const t=te("client");return r.assets.push({tag:"script",attrs:{src:t.inputs[t.handler]?.output.path,type:"module",async:!0,suppressHydrationWarning:!0}}),e}function et(){const e=Ye();return{...e,routes:Object.fromEntries(Object.entries(e.routes).map(([r,t])=>{const{preloads:n,assets:o}=t;return[r,{preloads:n,assets:o}]}))}}function re({tag:e,attrs:r,children:t}){switch(e){case"title":return d("title",{...r,suppressHydrationWarning:!0,children:t});case"meta":return d("meta",{...r,suppressHydrationWarning:!0});case"link":return d("link",{...r,suppressHydrationWarning:!0});case"style":return d("style",{...r,dangerouslySetInnerHTML:{__html:t}});case"script":return r&&r.src?d("script",{...r,suppressHydrationWarning:!0}):typeof t=="string"?d("script",{...r,dangerouslySetInnerHTML:{__html:t},suppressHydrationWarning:!0}):null;default:return null}}function I(e,r){const t=r||e||{};return typeof t.method>"u"&&(t.method="GET"),{options:t,middleware:n=>I(void 0,Object.assign(t,{middleware:n})),validator:n=>I(void 0,Object.assign(t,{validator:n})),handler:(...n)=>{const[o,s]=n;Object.assign(t,{...o,extractedFn:o,serverFn:s}),x(o.url,"createServerFn must be called with a function that is marked with the 'use server' pragma. Are you using the @tanstack/start-vite-plugin ?");const a=[...t.middleware||[],ot(t)];return Object.assign(async i=>B(a,"client",{...o,method:t.method,data:i?.data,headers:i?.headers,context:Object.assign({},o)}).then(c=>c.result),{...o,__executeServer:i=>{const c=i instanceof FormData?tt(i):i;return B(a,"server",{...o,...c}).then(u=>({result:u.result,context:u.sendContext}))}})}}}function tt(e){const r=e.get("__TSR_CONTEXT");if(e.delete("__TSR_CONTEXT"),typeof r!="string")return{context:{},data:e};try{return{context:m.parse(r),data:e}}catch{return{data:e}}}function rt(e){const r=[],t=n=>{n.forEach(o=>{o.options.middleware&&t(o.options.middleware),r.push(o)})};return t(e),r}const D=(e,r,t)=>e({data:r.data,context:r.context,sendContext:r.sendContext,method:r.method,next:n=>{const o={...r.context,...n?.context},s={...r.sendContext,...n?.sendContext??{}},a=F(r.headers,n?.headers);return t({method:r.method,data:r.data,context:o,sendContext:s,headers:a,result:n?.result??r.result})}});function nt(e,r){if(e==null)return{};if("~standard"in e){const t=e["~standard"].validate(r);if("value"in t)return t.value;throw t instanceof Promise?new Error("Async validation not supported"):new Error(JSON.stringify(t.issues,void 0,2))}if("parse"in e)return e.parse(r);if(typeof e=="function")return e(r);throw new Error("Invalid validator type!")}async function B(e,r,t){const n=rt(e),o=async s=>{const a=n.shift();if(!a)return s;a.options.validator&&(r!=="client"||a.options.validateClient)&&(s.data=await nt(a.options.validator,s.data));const i=r==="client"?a.options.client:a.options.server;return i?D(i,s,async c=>{if(r==="client"&&a.options.clientAfter){const u=await o(c);return D(a.options.clientAfter,u,l=>l)}return o(c)}):o(s)};return o({...t,headers:t.headers||{},sendContext:t.sendContext||{},context:t.context||{}})}function ot(e){return{_types:void 0,options:{validator:e.validator,validateClient:e.validateClient,client:async({next:r,sendContext:t,...n})=>{var o;const s=await((o=e.extractedFn)==null?void 0:o.call(e,{...n,context:t}));return r(s)},server:async({next:r,...t})=>{var n;const o=await((n=e.serverFn)==null?void 0:n.call(e,t));return r({result:o})}}}}const st=()=>{const e=g(),r=w({select:s=>s.matches.map(a=>a.meta).filter(Boolean)}),t=R.useMemo(()=>{const s=[],a={};let i;return[...r].reverse().forEach(c=>{[...c].reverse().forEach(u=>{if(u)if(u.title)i||(i={tag:"title",children:u.title});else{if(u.name){if(a[u.name])return;a[u.name]=!0}s.push({tag:"meta",attrs:{...u}})}})}),i&&s.push(i),s.reverse(),s},[r]),n=w({select:s=>s.matches.map(a=>a.links).filter(Boolean).flat(1).map(a=>({tag:"link",attrs:{...a}})),structuralSharing:!0}),o=w({select:s=>{const a=[];return s.matches.map(i=>e.looseRoutesById[i.routeId]).forEach(i=>{var c,u,l;return(l=(u=(c=e.manifest)==null?void 0:c.routes[i.id])==null?void 0:u.preloads)==null?void 0:l.filter(Boolean).forEach(f=>{a.push({tag:"link",attrs:{rel:"modulepreload",href:f}})})}),a},structuralSharing:!0});return ct([...t,...o,...n],s=>JSON.stringify(s))},at=()=>{const e=g(),r=st(),t=R.useContext(X.get("TanStackRouterHydrationContext",{}));return _(y,{children:[r.map((n,o)=>Q(re,{...n,key:`tsr-meta-${JSON.stringify(n)}`})),_(y,{children:[d(O,{log:!1,children:'__TSR__={matches:[],streamedValues:{},queue:[],runQueue:()=>{let e=!1;__TSR__.queue=__TSR__.queue.filter((_=>!_()||(e=!0,!1))),e&&__TSR__.runQueue()},initMatch:e=>{__TSR__.queue.push((()=>(__TSR__.matches[e.index]||(__TSR__.matches[e.index]=e,Object.entries(e.extracted).forEach((([e,_])=>{if("stream"===_.type){let e;_.value=new ReadableStream({start(_){e=_}}),_.value.controller=e}else if("promise"===_.type){let e,t;_.value=new Promise(((_,u)=>{e=_,t=u})),_.resolve=e,_.reject=t}}))),!0))),__TSR__.runQueue()},resolvePromise:e=>{__TSR__.queue.push((()=>{const _=__TSR__.matches[e.matchIndex];if(_){const t=_.extracted[e.id];if(t)return t.resolve(e.value.data),!0}return!1})),__TSR__.runQueue()},cleanScripts:()=>{document.querySelectorAll(".tsr-once").forEach((e=>{e.remove()}))}};'}),d(O,{children:`__TSR__.dehydrated = ${T(e.options.transformer.stringify(t),{isScriptContext:!0,wrap:!0,json:!0})}`})]})]})},it=()=>d(y,{children:at()});function ct(e,r){const t=new Set;return e.filter(n=>{const o=r(n);return t.has(o)?!1:(t.add(o),!0)})}const ut=()=>{const e=g(),r=w({select:o=>{const s=[];return o.matches.map(a=>e.looseRoutesById[a.routeId]).forEach(a=>{var i,c,u;return(u=(c=(i=e.manifest)==null?void 0:i.routes[a.id])==null?void 0:c.assets)==null?void 0:u.filter(l=>l.tag==="script").forEach(l=>{s.push({tag:"script",attrs:l.attrs,children:l.children})})}),s},structuralSharing:!0}),{scripts:t}=w({select:o=>({scripts:o.matches.map(s=>s.scripts).filter(Boolean).flat(1).map(({children:s,...a})=>({tag:"script",attrs:{...a,suppressHydrationWarning:!0},children:s}))})}),n=[...t,...r];return d(y,{children:n.map((o,s)=>Q(re,{...o,key:`tsr-scripts-${o.tag}-${s}`}))})},k=ve({head:()=>({meta:[{charSet:"utf-8"},{name:"viewport",content:"width=device-width, initial-scale=1"},{title:"Community Events"}]}),component:dt});function dt(){return d(lt,{children:d(Se,{})})}function lt({children:e}){return _("html",{children:[d("head",{children:d(it,{})}),_("body",{style:{backgroundColor:"rgba(32,34,38,255)",fontFamily:"Gill Sans",maxWidth:"700px",margin:"auto",padding:"12px 8px"},children:[e,d(we,{}),d(ut,{})]})]})}const ft=()=>import("./calendar-BtuAHGOy.js"),ne=z("/calendar")({component:G(ft,"component",()=>ne.ssr)});async function pt(e,r,t){var n;const o=r[0];if(q(o)&&o.method){const u=o,l=u.data instanceof FormData?"formData":"payload",f=new Headers({...l==="payload"?{"content-type":"application/json",accept:"application/json"}:{},...u.headers instanceof Headers?Object.fromEntries(u.headers.entries()):u.headers||{}});if(u.method==="GET"){const S=xe({payload:m.stringify({data:u.data,context:u.context})});S&&(e+=`&${S}`)}const p=new Request(e,{method:u.method,headers:f,...ht(u)}),h=await t(p),v=await W(h);if((n=v.headers.get("content-type"))!=null&&n.includes("application/json")){const S=await v.text(),E=S?m.parse(S):void 0;if(M(E)||$(E))throw E;return E}return v}const s=new Request(e,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(r)}),a=await W(await t(s)),i=a.headers.get("content-type"),c=await a.text();return i&&i.includes("application/json")?c?JSON.parse(c):void 0:c}function ht(e){return e.method==="POST"?e.data instanceof FormData?(e.data.set("__TSR_CONTEXT",m.stringify(e.context)),{body:e.data}):{body:m.stringify({data:e.data??null,context:e.context})}:{}}async function W(e){if(!e.ok){const r=e.headers.get("content-type"),t=r&&r.includes("application/json"),n=await(async()=>t?await e.json():await e.text())(),o=`Request failed with status ${e.status}`;throw t?new Error(JSON.stringify({message:o,body:n})):new Error([o,`${JSON.stringify(n,null,2)}`].join(`

`))}return e}function mt(e,r,t){return`${e}/_server/?_serverFnId=${encodeURI(r)}&_serverFnName=${encodeURI(t)}`}J(yt);async function yt(e){return oe(Z(e))}async function oe(e,r){var t,n;const o=e.method,s=new URL(e.url,"http://localhost:3000"),a=Object.fromEntries(s.searchParams.entries()),i=a._serverFnId,c=a._serverFnName;if(!i||!c)throw new Error("Invalid request");x(typeof i=="string","Invalid server action");const u=(n=await((t=te("server").chunks[i])==null?void 0:t.import()))==null?void 0:n[c],l=await(async()=>{try{const f=await(async()=>{var h;if((h=e.headers.get("Content-Type"))!=null&&h.includes("multipart/form-data"))return x(o.toLowerCase()!=="get","GET requests with FormData payloads are not supported"),await e.formData();if(o.toLowerCase()==="get")return a.payload?m.parse(a.payload):void 0;const v=await e.text();return m.parse(v)})(),p=await u(f);return p instanceof Response?p:M(p)||$(p)?U(p):new Response(p!==void 0?m.stringify(p):void 0,{status:Ae(A()),headers:{"Content-Type":"application/json"}})}catch(f){return f instanceof Response?f:M(f)||$(f)?U(f):(console.error("Server Fn Error!"),console.error(f),console.info(),new Response(JSON.stringify(f),{status:500,headers:{"Content-Type":"application/json"}}))}})();if(l.headers.get("Content-Type")==="application/json"){const p=await l.clone().text();p&&JSON.stringify(JSON.parse(p))}return l}function U(e){const{headers:r,...t}=e;return new Response(JSON.stringify(t),{status:200,headers:{"Content-Type":"application/json",...e.headers||{}}})}function _t(e,r,t){const n=mt("http://localhost:3000",r,t);return Object.assign((...s)=>(x(s.length===1,"Server functions can only accept a single argument"),pt(n,s,async a=>{const i=A(),c=qe(i);return Object.entries(c).forEach(([u,l])=>{a.headers.has(u)||a.headers.append(u,l)}),oe(a)})),{url:n,filename:r,functionId:t})}const gt=globalThis,vt=gt.prisma||new Ee,St=()=>import("./index-C0CpJkiP.js"),wt=I().handler(_t(xt,"c_11mpvlw","$$function0"),async()=>{let e=new Date;return e.setHours(0),await vt.event.findMany({where:{eventDate:{gte:e}},orderBy:[{eventDate:"asc"}]})}),se=z("/")({component:G(St,"component",()=>se.ssr)});function xt(e){return wt.__executeServer(e)}const Rt=ne.update({id:"/calendar",path:"/calendar",getParentRoute:()=>k}),Tt=se.update({id:"/",path:"/",getParentRoute:()=>k}),bt={IndexRoute:Tt,CalendarRoute:Rt},Et=k._addFileChildren(bt)._addFileTypes();function Ct(){return Re({routeTree:Et})}const Dt=Be({createRouter:Ct,getRouterManifest:et})(Ze);export{_t as a,I as c,wt as g,Dt as h,vt as p};
