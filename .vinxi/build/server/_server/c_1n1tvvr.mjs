import{jsxs as d,jsx as e,Fragment as c}from"react/jsx-runtime";import{c as u,a as p,p as y,g as O}from"./index.mjs";import h from"react";import{Pencil as F,Trash as R}from"lucide-react";import{useForm as B}from"@tanstack/react-form";import{ToastContainer as T,toast as s}from"react-toastify";import"@tanstack/react-router";import"tiny-invariant";import"@prisma/client";const j=({event:n,handleDelete:o,handleEdit:i})=>d("div",{style:{minWidth:"400px",maxWidth:"700px",width:"95%"},children:[d("div",{style:{display:"flex",justifyContent:"end",paddingRight:"12px",marginBottom:"4px"},children:[e("button",{style:{borderRadius:"4px",background:"none",border:"none",color:"gray"},onClick:()=>i(n),children:e(F,{})}),e("button",{style:{borderRadius:"4px",background:"none",border:"none",color:"gray"},onClick:()=>o(n.id),children:e(R,{})})]}),d("div",{style:{border:"solid #582F0E",borderRadius:"8px",backgroundColor:"#FAEDCD",display:"flex",gap:"8px",alignItems:"center",boxSizing:"border-box",maxHeight:"350px",paddingRight:"32px",boxShadow:"rgba(100, 0, 0, 0.24) 0px 3px 8px",margin:"0 8px"},children:[e("div",{style:{minWidth:"70px",display:"flex",justifyContent:"center"},children:e("span",{style:{fontSize:"2rem"},children:"🗓️"})}),d("div",{children:[e("h2",{children:e("a",{style:{color:"#0E577B"},href:n.eventLink,target:"_blank",rel:"noopener noreferrer",children:n.eventTitle})}),e("p",{style:{},children:n.eventDescription}),d("div",{style:{display:"flex",justifyContent:"space-between",gap:"12px"},children:[e("p",{children:n.eventDate.toLocaleDateString("it-IT")}),e("p",{children:n.communityName})]})]})]})]}),A="/_server/assets/skyline-milano-BEzzB3lN.png",v=n=>{const o={id:n.mode==="add"?"":n.event.id,communityName:n.mode==="add"?"":n.event.communityName,eventDate:n.mode==="add"?new Date:n.event.eventDate,eventDescription:n.mode==="add"?"":n.event.eventDescription,eventLink:n.mode==="add"?"":n.event.eventLink,eventTitle:n.mode==="add"?"":n.event.eventTitle},i=B({defaultValues:o,onSubmit:async({value:t})=>{n.mode==="add"?n.handleAdd(t):n.handleEdit(t)}});return d("div",{style:{height:"100%",display:"flex",flexDirection:"column",justifyContent:"center"},children:[d("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e("h2",{style:{color:"white"},children:n.mode==="add"?"Add new Event":"Edit Event"}),e("button",{style:{borderRadius:"4px",border:"1px solid white",background:"none",fontWeight:"600",color:"white",padding:"8px"},onClick:n.handleClose,title:"Close",children:"X"})]}),d("form",{style:{display:"flex",flexDirection:"column",gap:"16px",fontSize:"1rem",color:"white"},onSubmit:t=>{t.preventDefault(),t.stopPropagation(),i.handleSubmit()},children:[e("div",{style:{width:"100%"},children:e(i.Field,{name:"communityName",children:t=>d("div",{children:[e("label",{htmlFor:t.name,children:e("p",{style:{margin:"2px 0"},children:"Community Name"})}),e("input",{style:{width:"100%",padding:"6px 2px",borderStyle:"none",borderRadius:"2px",backgroundColor:"#DDDDDD"},name:t.name,value:t.state.value,onBlur:t.handleBlur,onChange:a=>t.handleChange(a.target.value)})]})})}),e("div",{style:{width:"100%"},children:e(i.Field,{name:"eventTitle",children:t=>d(c,{children:[e("label",{htmlFor:t.name,children:e("p",{style:{margin:"2px 0"},children:"Event Title"})}),e("input",{style:{width:"100%",padding:"6px 2px",borderStyle:"none",borderRadius:"2px",backgroundColor:"#DDDDDD"},name:t.name,value:t.state.value,onBlur:t.handleBlur,onChange:a=>t.handleChange(a.target.value)})]})})}),e("div",{style:{width:"100%"},children:e(i.Field,{name:"eventDescription",children:t=>d(c,{children:[e("label",{htmlFor:t.name,children:e("p",{style:{margin:"2px 0"},children:"Event Description"})}),e("textarea",{style:{width:"100%",padding:"6px 2px",borderStyle:"none",borderRadius:"2px",backgroundColor:"#DDDDDD"},name:t.name,rows:5,maxLength:300,value:t.state.value,onBlur:t.handleBlur,onChange:a=>t.handleChange(a.target.value)})]})})}),e("div",{style:{width:"100%"},children:e(i.Field,{name:"eventLink",children:t=>d(c,{children:[e("label",{htmlFor:t.name,children:e("p",{style:{margin:"2px 0"},children:"Event Link"})}),e("input",{style:{width:"100%",padding:"6px 2px",borderStyle:"none",borderRadius:"2px",backgroundColor:"#DDDDDD"},name:t.name,value:t.state.value,onBlur:t.handleBlur,onChange:a=>t.handleChange(a.target.value)})]})})}),e("div",{style:{width:"100%"},children:e(i.Field,{name:"eventDate",children:t=>d(c,{children:[e("label",{htmlFor:t.name,children:e("p",{style:{margin:"2px 0"},children:"Event Date"})}),e("input",{style:{width:"100%",padding:"6px 2px",borderStyle:"none",borderRadius:"2px",backgroundColor:"#DDDDDD"},name:t.name,type:"date",min:new Date().toISOString().slice(0,10),value:t.state.value.toISOString().slice(0,10),onBlur:t.handleBlur,onChange:a=>t.handleChange(new Date(a.target.value))})]})})}),e("div",{style:{display:"flex",justifyContent:"center"},children:e("button",{style:{color:"rgba(32,34,38,255)",backgroundColor:"white",borderRadius:"4px",border:"1px solid white",padding:"6px 24px",fontWeight:"600"},type:"submit",children:"Submit"})})]})]})},g=u({method:"POST"}).validator(n=>n).handler(p(I),async({data:n})=>await y.event.create({data:n})),x=u({method:"POST"}).validator(n=>n).handler(p(W),async({data:n})=>await y.event.delete({where:{id:n}})),b=u({method:"POST"}).validator(n=>n).handler(p(_),async({data:n})=>await y.event.update({where:{id:n.id},data:n})),q=function(){const[o,i]=h.useState({isOpen:!1,mode:"add"}),[t,a]=h.useState([]),[D,w]=h.useState(),f=()=>{i({isOpen:!0,mode:"add"})};h.useEffect(()=>{(async()=>{try{const l=await O();a(l)}catch(l){console.error(l)}})()},[]);const C=async r=>{try{await g({data:r}),a([...t,r]),i({isOpen:!1,mode:"add"}),s("✅ Event created successfully")}catch{s("❌ Ops.. something went wrong")}},E=async r=>{try{await b({data:r});const l=[...t],m=l.findIndex(k=>k.id===r.id);l[m]=r,a(l),i({isOpen:!1,mode:"add"}),s("✅ Event updated successfully")}catch{s("❌ Ops.. something went wrong")}},S=async r=>{if(window.confirm("Are you sure you want to delte this event?"))try{const l=t.filter(m=>m.id!==r);a(l),await x({data:r}),s("✅ Event deleted successfully")}catch{s("❌ Ops.. something went wrong")}};return d("div",{children:[d("nav",{style:{display:"flex",justifyContent:"space-between"},children:[e("h1",{style:{margin:"0",color:"white",fontSize:"1.3rem",fontFamily:"cursive"},children:"My Community Events"}),e("button",{style:{color:"white",backgroundColor:"rgba(32,34,38,255)",borderRadius:"4px",border:"1px solid white",boxShadow:"rgba(255, 255, 255, 50) 1px 1px 2px 0px",padding:"4px 12px"},onClick:f,children:e("span",{children:"Add Event"})})]}),o.isOpen&&e("div",{style:{position:"fixed",top:0,left:0,height:"100%",width:"100%",backgroundColor:"rgba(0,0,0, 0.8)"},children:e("dialog",{style:{backgroundColor:"rgba(32,34,38,255)",border:"solid gray",borderRadius:"8px",width:"80%",maxWidth:"600px",minWidth:"250px",position:"absolute",top:"20%"},open:o.isOpen,children:o.mode==="add"?e(v,{mode:"add",handleAdd:C,handleClose:()=>i({isOpen:!1,mode:"add"})}):e(v,{mode:"edit",handleEdit:E,handleClose:()=>i({isOpen:!1,mode:"add"}),event:D??{}})})}),e("div",{style:{display:"flex",justifyContent:"center"},children:e("div",{style:{maxWidth:"700px"},children:e("img",{style:{margin:"auto",width:"100%"},src:A})})}),d("div",{style:{display:"flex",justifyContent:"center"},children:[e("div",{style:{display:"flex",flexDirection:"column",justifyContent:"center",alignContent:"center",alignItems:"center",gap:"40px"},children:t.map(r=>e(j,{event:r,handleDelete:S,handleEdit:()=>{i({isOpen:!0,mode:"edit"}),w(r)}},r.id))}),e(T,{theme:"dark",autoClose:3e3})]})]})};function I(n){return g.__executeServer(n)}function W(n){return x.__executeServer(n)}function _(n){return b.__executeServer(n)}export{I as $$function0,W as $$function1,_ as $$function2,q as component};
